# Agent Handoff (2026-02-16)

## 1. Context
- Branch in use: `develop` (do not touch `main`).
- Main goals addressed in this cycle:
1. Keep improving auth UX (`login/register`) aligned with site style.
2. Implement a real admin dashboard for content/operations.
3. Move admin content persistence from JSON bucket (`admin_content`) to normalized relational tables (Phase 2).

## 2. Current implementation status

### 2.1 Auth and public UX
- `login/register` redesign implemented with:
1. left visual panel image (`apps/web/public/auth-register-counter.svg`)
2. styled switch between login/register
3. clear links between forms
4. `recover-password` placeholder route.
- Main files:
1. `apps/web/src/app/auth/page.module.css`
2. `apps/web/src/app/login/LoginClient.tsx`
3. `apps/web/src/app/register/RegisterClient.tsx`
4. `apps/web/src/app/recover-password/page.tsx`

### 2.2 Admin dashboard (web)
- New dashboard with tabs:
1. Stats
2. Site/Hero
3. Trainers
4. Activities
5. Benefits
6. Plans
7. QR check-in
- Main files:
1. `apps/web/src/app/admin/dashboard/AdminDashboardClient.tsx`
2. `apps/web/src/app/admin/dashboard/AdminDashboardClient.module.css`

### 2.3 Public content dynamic loading
- Home and activity pages consume API content (`/api/content/*`) with fallback data.
- Main files:
1. `apps/web/src/lib/public-content.ts`
2. `apps/web/src/app/page.tsx`
3. `apps/web/src/app/actividades/page.tsx`
4. `apps/web/src/app/actividades/[slug]/page.tsx`
5. `apps/web/src/components/Plans/Plans.tsx`

## 3. Phase 2 data model (normalized)

### 3.1 New backend entities/tables
- Added:
1. `gym_site_settings` -> `apps/api/src/modules/admin/entities/gym-site-settings.entity.ts`
2. `trainers` -> `apps/api/src/modules/admin/entities/trainer.entity.ts`
3. `activities` -> `apps/api/src/modules/admin/entities/activity.entity.ts`
4. `benefits` -> `apps/api/src/modules/admin/entities/benefit.entity.ts`
5. `activity_trainers` join table generated by many-to-many relation in `Activity`.

### 3.2 Existing table expanded
- `plans` entity now includes:
1. `description`
2. `features` (`text[]`)
3. `highlight` (`boolean`)
4. `badge` (`varchar nullable`)
- Files:
1. `apps/api/src/modules/billing/entities/plan.entity.ts`
2. `packages/shared/src/interfaces/index.ts` (`IPlan` extended)
3. `apps/api/src/modules/billing/billing.service.ts` (seed defaults updated)

### 3.3 Legacy compatibility
- `admin_content` is still present only as a legacy source.
- `AdminContentService` now writes/reads normalized tables, and attempts one-time migration from old `admin_content` payloads when available.
- File:
1. `apps/api/src/modules/admin/admin-content.service.ts`

## 4. API changes (admin)

### 4.1 Endpoints maintained
- Public:
1. `GET /api/content/home`
2. `GET /api/content/activities`
3. `GET /api/content/activities/:slug`
- Admin:
1. `GET /api/admin/stats`
2. `GET/PATCH /api/admin/content/site`
3. `GET/POST/PATCH/DELETE /api/admin/content/trainers`
4. `GET/POST/PATCH/DELETE /api/admin/content/activities`
5. `GET/POST/PATCH/DELETE /api/admin/content/benefits`
6. `GET/POST/DELETE /api/admin/content/plans`

### 4.2 DTO validation added
- `payload: any` removed in admin controller; now using class-validator DTOs:
1. `dto/site-settings.dto.ts`
2. `dto/trainer.dto.ts`
3. `dto/activity.dto.ts`
4. `dto/benefit.dto.ts`
5. `dto/plan-content.dto.ts`
6. `dto/stats-range.dto.ts`

## 5. Build/test status at handoff
- Executed successfully:
1. `pnpm --filter @gym-admin/shared build`
2. `pnpm --filter @gym-admin/api build`
3. `pnpm --filter @gym-admin/web build`
4. `pnpm --filter @gym-admin/web test` (39 passing)

## 6. Manual QA still required (user + admin)
1. Login/register full flow (manual + Google).
2. Admin CRUD:
 - create/edit/delete trainer
 - create/edit/delete activity and trainer assignment
 - create/edit/delete benefit
 - create/edit/deactivate plan
 - edit site/hero copy.
3. Public pages reflect admin updates immediately:
 - home
 - activities grid
 - activity detail.
4. Plan selection still works end-to-end with checkout flow.
5. QR admin tab still generates usable URLs.

## 7. Important repo state note
- Working tree is dirty with many files changed from previous sessions.
- Do not revert unrelated files unless explicitly requested.
- Prefer committing in logical chunks after QA.

## 8. Suggested next actions after context reset
1. Open new chat and request: "Read `docs/agent-handoff.md` and continue from develop."
2. Run services and smoke test:
 - `pnpm dev`
 - admin login and dashboard checks
 - user purchase/check-in checks
3. If all good, split commits:
 - commit A: backend normalization + DTOs
 - commit B: web admin dashboard + public content integration
 - commit C: auth visual polish (if desired separated).

